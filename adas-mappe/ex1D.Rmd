---
title: "Exercise 1 - TMA4300 Computer Intensive Statistical Methods"
output: html_notebook
---
Question D 1 
We want to sample from 
$$
f(\theta|\mathbf{y})\propto(2+\theta)^{y_1}(1-\theta)^{y_2+y_3}\theta^{y_4}
$$
by using rejection sampling and using $g(\theta) = U(0,1)$ as the proposal density. We use the maximum of $f$ as the constant $c$ in rejection sampling, to ensure $\frac{f(\theta|y)}{g(\theta)} \leq c$. 

```{r}
# f is the  posterior function to sample from, not normalized
# theta: parameter between 0 and 1, sampled from U(0,1)
# y: observed values
f <- function(theta, y) {
  return((2+theta)^y[1]*(1-theta)^(y[2]+y[3])*theta^y[4])
}

# f_normalized is the posterior function, normalized
f_normalized <- function(theta, y) {
  c = integrate(f_theta_given_y,0,1,y)$value
  return(f/c)
}

# alpha finds the acceptance probability alpha
alpha <- function(theta, y) {
  max_f = optimize(f, interval = c(0,1), maximum = TRUE, y=y)
  c = max_f$objective
  return(f(theta, y)/c)
}

# rejection_d samples from the posterior by rejection sampling
# n: number of samples to generate
rejection_d <- function(y, n) {
  out = 1:n
  g = function() {return(runif(1))}
  
  for (i in 1:n) {
    finished = 0
    while(finished==0) {
      u = runif(1)
      theta = g()
      alpha = alpha(theta, y)
      if(u <= alpha) {
        out[i] = theta
        finished = 1
      }
    }
  }
  return(out)
}

y = c(125,18,20,34)
n = 10000

hist(rejection_d(y, n), breaks = 50, freq = FALSE, main = bquote("Histogram of posterior"))
curve(f_normalized, col = "red", lwd = 2, add = TRUE)

```
