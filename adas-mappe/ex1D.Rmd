---
title: "Exercise 1 - TMA4300 Computer Intensive Statistical Methods"
output: html_notebook
---
Question D 1 
We want to sample from 
$$
f(\theta|\mathbf{y})\propto(2+\theta)^{y_1}(1-\theta)^{y_2+y_3}\theta^{y_4}
$$
by using rejection sampling and using $g(\theta) = U(0,1)$ as the proposal density. We use the maximum of $f$ as the constant $c$ in rejection sampling, to ensure $\frac{f(\theta|y)}{g(\theta)} \leq c$. 

```{r}
# f is the  posterior function to sample from, not normalized
# theta: parameter between 0 and 1, sampled from U(0,1)
# y: observed values
f <- function(theta, y) {
  return((2+theta)^y[1]*(1-theta)^(y[2]+y[3])*theta^y[4])
}

# f_normalized is the posterior function, normalized
f_normalized <- function(theta, y) {
  c = integrate(f,0,1,y)$value
  return(f(theta,y)/c)
}

# alpha finds the acceptance probability alpha
alpha <- function(theta, y) {
  c = optimize(f, interval = c(0,1), maximum = TRUE, y=y)$objective
  return(f(theta, y)/c)
}

# rejection_d samples from the posterior by rejection sampling
# n: number of samples to generate
rejection_d <- function(y, n) {
  out = 1:n
  g = function() {return(runif(1))}
  
  for (i in 1:n) {
    finished = 0
    while(finished==0) {
      u = runif(1)
      theta = g()
      alpha = alpha(theta, y)
      if(u <= alpha) {
        out[i] = theta
        finished = 1
      }
    }
  }
  return(out)
}

y = c(125,18,20,34)
n = 10000

library(ggplot2)
samples_d1 <- rejection_d(y, n)
x <- seq(0,1,0.001)
data_d1 <- data.frame("samples_d1"=samples_d1)
ggplot(data=data_d1, aes(data_d1$samples_d1)) +
geom_histogram(aes(y=..density..), breaks = seq(0, 1, by = 0.005)) +theme(plot.title = element_text(hjust = 0.5))+
xlim(c(0.4,0.85)) + labs(title="Posterior density", x="x", y="Density") +
stat_function(fun = f_normalized, args = list(y), color = "red")
```
From the plot we see that the theoretical and the simulated distribution follow each other. 
