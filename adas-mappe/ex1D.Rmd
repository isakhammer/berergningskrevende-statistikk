---
title: "Exercise 1 - TMA4300 Computer Intensive Statistical Methods"
output: html_notebook
---
Question D 1 
We want to sample from 
$$
f(\theta|\mathbf{y})\propto(2+\theta)^{y_1}(1-\theta)^{y_2+y_3}\theta^{y_4}
$$
by using rejection sampling and using $g(\theta) = U(0,1)$ as the proposal density. We use the maximum of $f$ as the constant $c$ in rejection sampling, to ensure $\frac{f(\theta|y)}{g(\theta)} \leq c$. 

```{r}
# f is the  posterior function to sample from, not normalized
# theta: parameter between 0 and 1, sampled from U(0,1)
# y: observed values
f <- function(theta, y) {
  return((2+theta)^y[1]*(1-theta)^(y[2]+y[3])*theta^y[4])
}

# alpha finds the acceptance probability alpha
alpha <- function(theta, y) {
  max_f = optimize(f, interval = c(0,1), maximum = TRUE, y=y)
  c = max_f$objective
  g = runif(1)
  return(f(theta, y)/(c*g))
}

# rejection_d samples from the posterior by rejection sampling
# n: number of samples to generate
rejection_d <- function(y, n) {
  out = 1:n
  g = function() {return(runif(1))}
  
  for (i in 1:n) {
    finished = 0
    while(finished==0) {
      u = runif(1)
      theta = g()
      alpha = alpha(theta, y)
      print(alpha)
      if(u <= alpha) {
        out[i] = theta
        finished = 1
      }
    }
  }
  return(out)
}

y = c(125,18,20,34)

#The multinomial mass function
mass_function = function(theta, y) {
  int = integrate(f, 0, 1) # integrate f*(theta|y) from 0 to 1
  c = 1 / (int$value) # use integral to find the normalizing constant
  return(c*f(theta, y)) # f(theta|y)
}

#Tests the implementation
test_D1 = function(y,n) {
  samples = rejection_d(y,n)
  hist(samples, breaks = 30, freq = FALSE, main = bquote("Histogram of samples"))
  curve(mass_function, col = "red", lwd = 2, add=TRUE)
}

test_D1(y,10000)
```
