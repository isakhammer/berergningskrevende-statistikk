---
title: "ex1b"
output: html_notebook
---

# Task B1
## Task B1a

The acceptance probability has the form
$$
P(U\leq\frac{f(x)}{cg(x)}) = \int_{-\infty}^{\infty}\frac{f(x)}{cg(x)}g(x)dx = \int_{-\infty}^{\infty}\frac{f(x)}{c}dx = \frac{1}{c}
$$

where $c$ is such that $\frac{f(x)}{g(x)}\leq c$. To find $c$, consider the expression $f(x)\leq cg(x)$. Then we get (for the nontrivial cases when $x>0$)

$$
\frac{1}{\Gamma(\alpha)}x^{\alpha-1}e^{-x}\leq \begin{cases}
c\frac{e\alpha}{e+\alpha}x^{\alpha-1}, 0 < x < 1\\
c\frac{e\alpha}{e+\alpha}e^{-x}, x \geq 1\\
\end{cases}
$$
Rearranging the inequalities and using that $e^{-x}$ and $x^{\alpha-1}$ are decreasing functions, we get the following upper bound for $c$:

$$
c\geq\frac{1}{\Gamma(\alpha)}\frac{e+\alpha}{e\alpha}
$$
So we choose $c = \frac{1}{\Gamma(\alpha)}\frac{e+\alpha}{e\alpha}$ to satisfy our initial inequality. The acceptance probability is then $\frac{1}{c} = \frac{\Gamma(\alpha)e\alpha}{e+\alpha}$.

## Task B1b
To generate $n$ independent samples from $f$ by rejection sampling, we need to find the expression $\alpha = \frac{1}{c}\frac{f(x)}{g(x)}$, with the proposal $g$ from problem A2 and $f$ as given in the exercise. We therefore use $c$ as found in the previous exercise and we sample from $g$ as in problem A2. 
```{r}
# f_b1 returns the value of f in this exercise, a gamma distribution
f_b1 <- function(alpha, x) {
  gamma = (1/gamma(alpha))*x^(alpha-1)*exp(-x)
  return(gamma)*(x>0)
}

# Delete this before the files are merges, only for help 
# alpha: parameter alpha
# n: number of samples to generate
# dist1 returns a vector of random numbers from the distribution g
dist1 <- function(alpha, n) {
   u <- runif(n)
   L = u<ca(alpha)/alpha
   res = c(1:n)*0
   res[L] = (u[L]*alpha/ca(alpha))^(1/alpha)
   res[!L] = -log((1-u[!L])/ca(alpha))
   return(list(res,u))
}

# g_test is the theoretical function to test the algorithm with 
g_test = function(alpha, x) {
  res = c(1:length(x))*0
  L = x<1&x>0
  res[L] = ca(alpha)*x[L]^(alpha-1)
  res[!L] = ca(alpha)*exp(-x[!L])
  return (res)
}

# acceptance_criterion returns the alpha to accept/reject in rejection sampling
acceptance_criterion <- function(alpha, x) {
  const = (exp(1)+alpha)/(gamma(alpha)*exp(1)*alpha)
  alpha = f_b1(alpha, x)/(const*g_test(alpha, x))
  return(alpha)
}

# rejection_b generates samples from f by rejection sampling
# n: number of samples to generate
# alpha: shape parameter 
rejection_b <- function(alpha, n) {
  out = 1:n
  
  for (i in 1:n) {
    finished = 0
    while(finished==0) {
      u = runif(1)
      x = dist1(alpha, 1)
      acceptance = acceptance_criterion(alpha, x)
      if(u <= alpha) {
        out[i] = x
        finished = 1
      }
    }
  }
  return(out)
}

n = 10000
alpha = 0.5

library(ggplot2)
samples_b1 <- rejection_b(alpha, n)
x <- seq(0,1,0.001)
data_b1 <- data.frame("samples_b1"=samples_b1)
ggplot(data=data_b1, aes(data_b1$samples_b1)) +
geom_histogram(aes(y=..density..), breaks = seq(0, 1, by = 0.005)) +theme(plot.title = element_text(hjust = 0.5))+
xlim(c(0,4)) + labs(title="Samples from gamma distribution", x="x", y="Density") +
stat_function(fun = g_test, args = list(shape = alpha), color = "red")

```

# Task B2
## Task B2a

We can define the domain 
$$
C_f = \Big \{ (x_1, x_2) : 0 \le x_1 \le \sqrt{f^{*}\Big(\frac{x_2}{x_1}\Big)}  \Big \}
$$
where 
$$
f(x) =
\begin{cases}
x^{\alpha -1}e^{-x}, \quad & x> 0 \\
0, \quad & x\le 0 \\
\end{cases}
$$ We now want to define some upper and lower bounds such that 
$$
\begin{align}
a_{-} &= \sqrt{{sup}_x f(x)  } = \sqrt{f(\alpha -1)} \\ 
b_{+} &= \sqrt{{sup}_{x \ge 0} x^2 f(x)  } = \sqrt{(\alpha +1)^2 f(\alpha +1)}\\
b_{-} &= \sqrt{{sup}_{x \le 0} x^2 f(x)  } = 0
\end{align}
$$

The supremum for $a_{-}$ and $b_{+}$ can easily be derived by finding extremal points of the function using derivation and $b_{-}$ follows from $f(x) = 0$ for $x\le 0$.

## Task B2b

We now want to generate $n$ samples of $f$ for different values of $alpha$ 

However, the explicit function will quickly become very large for big $\alpha$. To handle this will we introduce the substitution $x = ln(y) = g(y)$ such that $g^{-1} (x) = e^x,  g^{-1}`(x) = e^x $. Hence, using the change of variable function, we get

$$
\begin{align}
f_Y (y) &= f_X(g^{-1}(x))\cdot \left| \frac{d g^{-1}(x)} {dx} \right| \\
  &= f_X(e^x) \cdot  e^x  \quad \text{completely wrong}
\end{align}
$$

```{r}
# TODO: Write an R function that generates a vector of n independent samples from f. Use the function
# to check how many tries the algorithm needs to generate n = 1000 realisations depending on
# the value of α ∈ (1, 2000]. Generate a plot with values of α on the x-axis and the number of
# tries used on the y-axis. Interpret the result.
# Caution: You need to implement the algorithm on log-scale, otherwise you will get NAs already
# for α around 30.
```


# Task B3


We want to generate $n$ samples of the gamma distribution

$$
f(x) = \frac{\beta^{\alpha}}{\Gamma (\alpha)} x^{\alpha -1} e^{-\beta}
$$



```{r}
# TODO: Write an R function that generates a vector of n independent samples from a gamma distribution
#with parameters α and β. Note that the function should work for any values α > 0 and β > 0,

rate <- 1 
x <- seq(0, 5, by=0.0001)  
alpha =3
beta=1
plot(x,dgamma(x, shape=alpha, rate=beta))

```


